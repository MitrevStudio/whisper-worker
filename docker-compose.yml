version: "3.9"

services:
  # GPU version - requires NVIDIA GPU with Docker GPU support
  worker-gpu:
    build:
      context: .
      dockerfile: Dockerfile
    image: whisper-worker:gpu
    environment:
      WORKER__Name: whisper-worker-gpu
      WORKER__ApiUrl: http://192.168.50.26:5239
      WORKER__Token: "sk-worker-AqXlK2aL0UbFm7xcVrDYmFo8Ads6EyUscMCeLzCE2IAyZesv"
      WORKER__ModelPath: /models
      WORKER__TempPath: /tmp/whisper
      WORKER__HeartbeatIntervalSeconds: 30
    volumes:
      - whisper_models:/models
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]
    profiles:
      - gpu

  # CPU version - works on any system without GPU
  worker-cpu:
    build:
      context: .
      dockerfile: Dockerfile.cpu
    image: whisper-worker:cpu
    environment:
      WORKER__Name: whisper-worker-cpu
      WORKER__ApiUrl: http://192.168.50.26:5239
      WORKER__Token: "sk-worker-AqXlK2aL0UbFm7xcVrDYmFo8Ads6EyUscMCeLzCE2IAyZesv"
      WORKER__ModelPath: /models
      WORKER__TempPath: /tmp/whisper
      WORKER__HeartbeatIntervalSeconds: 30
    volumes:
      - whisper_models:/models
    profiles:
      - cpu

volumes:
  whisper_models:
    driver: local
